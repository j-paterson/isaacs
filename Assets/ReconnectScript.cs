using UnityEngine;
using System.Collections;
using System.Collections.Generic;

using ROSBridgeLib;

public class ReconnectScript : MonoBehaviour {

    /* This script allows users to change the IP address that the Hololens is streaming data to. Ip addresses
     * are stored in ipList, and to connect to the specific IP address you must press change IP until the 
     * ip number (currentHost) cooresponds to the index of the ip address in IP list. 
     * 
     */ 
    Main main;
    TextMesh debugText;
    public ROSBridgeWebSocketConnection ros;
    public List<string> ipList = new List<string>();
    public int currentHost = 0;


    /* 192.168.202 cooresponds to the IP address of the manifold. 
     * 192.168.160 cooresponds to the IP address of the Lear's laptop
     */ 
    void Start()
    {
        main = GameObject.Find("GameManager").GetComponent<Main>();
        debugText = GameObject.Find("Debug").GetComponent<TextMesh>();
        ros = GameObject.Find("ROSBridge").GetComponent<ROSBridgeScript>().ros;
        ipList.Add("192.168.0.202");
        ipList.Add("192.168.0.203");
        ipList.Add("192.168.0.160");
        ipList.Add("192.168.10.203");
        ipList.Add("192.168.0.185")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ;
        ipList.Add("192.168.43.13");
        ipList.Add("192.168.0.133");
        ipList.Add("192.168.43.173");
    }

    void Update()
    {
        if (debugText == null)
        {
            debugText = GameObject.Find("Debug").GetComponent<TextMesh>();
        }

        if (ros == null)
        {
            ros = GameObject.Find("ROSBridge").GetComponent<ROSBridgeScript>().ros;
        }
    }
    
    /* When the recenter panel is pressed the rosbridge attempts to reconnect
     * to the IP address of currentHost. 
     */ 

    void OnSelect()
    {
        debugText.text = "reconnect start";
        ros.Disconnect();
        ros.ChangeHost(ipList[currentHost]);
        ros.Connect(); 
        debugText.text = "reconnect end";
    }
}
